<!doctype html><html lang=en><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><meta content="ie=edge"http-equiv=X-UA-Compatible><title>Document</title><style>body{padding:20px;display:flex;flex-direction:column;justify-content:center;align-items:center;background-color:bisque}#tablica{margin-bottom:30px;margin-top:30px}#file{margin:20px}canvas{margin:10px}img{margin:10px}nav{display:flex;top:0;position:fixed;width:100%;background-color:#00008b}nav a{color:azure;text-decoration:none;text-align:center;padding:14px 16px;transition:all .3s;font-weight:bolder;text-transform:uppercase}nav a:hover{background-color:#00bfff;color:#f5f5f5}h1{padding:14px 16px;color:#00008b;font-weight:bolder;font-stretch:extra-expanded;font-size:300%;text-align:center}h4{text-transform:uppercase}h2{text-transform:uppercase}table{color:#00008b;padding:10px 13px;width:100%}td,tr{text-align:center;padding:14px 16px;font-weight:bolder;text-transform:uppercase}.kontejner{background-color:#f5f5f5;padding:14px 20px;color:#00008b}hr{padding:10px}</style><nav><a href=# id=izaberi class=gumb>Izaberi datoteku</a> <a href=# id=obrada class=gumb onclick=napraviTablicuObrade()>Prikaži obradu </a><a href=# id=link>Skini tablicu</a></nav><div class=kontejner id=kontejner><h1>OCT ANGIO ANALIZATOR ŽBČ</h1><input accept=".jpg, .jpeg, .png, .bmp"id=file multiple name=datoteke type=file><h4 id=prikazdat></h4><br><table class=tablica id=tablica><tr><th>Slika naslov<th>udio žila i kapilara u %</table></div><br><div class=kontejner id=kontejnertablica></div><script>//***********************OBRADA ANGIO OCT  ŽBČ***************************************
    // VERZIJA 1.0.0.
    //AUTOR VLATKO VUČENIK 8.12.2019
    //******Funkcije html elementi
const napraviTablicu=function(e=[],a){let t=document.createElement("table");t.setAttribute("class","tablica");let n=document.createElement("tr"),r=document.createElement("th"),i=document.createElement("th");return r.textContent="Slika naslov",n.appendChild(r),i.textContent="udio žila i kapilara u%",n.appendChild(i),t.appendChild(n),e.forEach(e=>{let a=document.createElement("tr"),n=document.createElement("td"),r=document.createElement("td");n.innerText=e.naslov,a.appendChild(n),r.innerText=e.prosjek,a.appendChild(r),t.appendChild(a)}),t},napraviTablicuObrade=function(){for(;kontejnerTablica.firstChild;)kontejnerTablica.removeChild(kontejnerTablica.firstChild);let e=`<h4> Aritmetička sredina ${obrada.deepObrada.aritmetičkaSredina} </h4>\n<h4> Medijan ${obrada.deepObrada.medijan} </h4>\n<h4> Raspon ${obrada.deepObrada.raspon[0]} - ${obrada.deepObrada.raspon[1]} </h4>\n<h4> Prosječno odstupanje od aritmetičke sredine ${obrada.deepObrada.odstupanjeOdSredine} </h4>\n<h4> Varijanca ${obrada.deepObrada.varijanca} </h4>\n<h4> Standardna devijacija ${obrada.deepObrada.standardnaDevijacija} </h4>\n`,a=`<h4> Aritmetička sredina ${obrada.superfObrada.aritmetičkaSredina} </h4>\n<h4> Medijan ${obrada.superfObrada.medijan} </h4>\n<h4> Raspon ${obrada.superfObrada.raspon[0]} - ${obrada.superfObrada.raspon[1]} </h4>\n<h4> Prosječno odstupanje od aritmetičke sredine ${obrada.superfObrada.odstupanjeOdSredine} </h4>\n<h4> Varijanca ${obrada.superfObrada.varijanca} </h4>\n<h4> Standardna devijacija ${obrada.superfObrada.standardnaDevijacija} </h4>\n`;kontejnerTablica.insertAdjacentHTML("afterBegin"," <h2>Obrada DEEP</h2>"),kontejnerTablica.appendChild(napraviTablicu(obrada.deep)),kontejnerTablica.insertAdjacentHTML("beforeEnd",e),kontejnerTablica.insertAdjacentHTML("beforeEnd"," <h2>Obrada superficijal</h2>"),kontejnerTablica.appendChild(napraviTablicu(obrada.superf)),kontejnerTablica.insertAdjacentHTML("beforeEnd",a)},napraviRGB=(e=[])=>{let a=[];e.data.length;for(let t=0;t<e.data.length;t+=4){let n=[];n.push(e.data[t]),n.push(e.data[t+1]),n.push(e.data[t+2]),n.push(e.data[t+3]),a.push(n)}return a},raspodjela=function(e=[]){let a=e.reduce((e,a)=>((a[0]<51||a[1]<51||a[2]<51)&&(e[0]=e[0]+1),(a[0]<102&&a[0]>51||a[1]<102&&a[1]>51||a[2]<102&&a[2]>51)&&(e[1]=e[1]+1),(a[0]<153&&a[0]>102||a[1]<153&&a[1]>102||a[2]<153&&a[2]>102)&&(e[2]=e[2]+1),(a[0]<204&&a[0]>153||a[1]<204&&a[1]>153||a[2]<204&&a[2]>153)&&(e[3]=e[3]+1),(a[0]>204||a[1]>204||a[2]>204)&&(e[4]=e[4]+1),e),[0,0,0,0,0]);return a=a.map(a=>(a/e.length*100).toFixed(1))},obrniRGB=(e=[])=>{let a=[];e.data.length;for(let t=0;t<e.data.length;t+=4){a.push(255-e.data[t]),a.push(255-e.data[t+1]),a.push(255-e.data[t+2]),a.push(e.data[t+3])}return a},dajProsjekRgb=function(e=[]){let a=e.reduce((e,a)=>(e[0]=e[0]+a[0],e[1]=e[1]+a[1],e[2]=e[2]+a[2],e[3]=e[3]+a[3],e),[0,0,0,0]);return a=a.map(a=>a/e.length),a=Math.ceil(a[0])},rafiniraj=function(e=[],a=110){return e.reduce((e,t)=>(t[0]<a||t[1]<a||t[2]<a?e.push([255,255,255,255]):t[0]>153||t[1]>153||t[2]>153?e.push([255,0,0,255]):t[0]<153&&t[0]>a||t[1]<153&&t[1]>a||t[2]<153&&t[2]>a?e.push([0,255,0,255]):e.push([255,255,255,255]),e),[])},prosjekRafinirani=function(e=[],a=110){return e.filter(e=>e[0]<a||e[1]<a||e[2]<a).length/e.length},napraviObjekt=function(e="",a=0,t=0){let n=e;return{naslov:e,prosjek:a,rgbprosjek:t,deep:/deep/gi.test(n),superf:/superficial/gi.test(n)}},arimetickaSredina=function(e=[]){return(e.reduce((e,a)=>e+Number(a),0)/(e.length||1)).toFixed(2)},medijan=function(e=[]){let a=[...e];if(a.sort((e,a)=>e-a),a.length){let e=a.length,t=Math.floor(e/2);if(e%2==0){return((Number(a[t-1])+Number(a[t]))/2).toFixed(2)}return Number(a[t]).toFixed(2)}},raspon=function(e=[]){let a=[...e];return a.sort((e,a)=>e-a),(Number(a[a.length-1])-Number(a[0])).toFixed(2)},prosAbOdstOdAritSred=function(e=[],a=arimetickaSredina(e)){return(e.reduce((e,t)=>e+Math.abs(Number(t)-a),0)/e.length).toFixed(2)},varijanca=function(e=[],a=arimetickaSredina(e)){return(e.reduce((e,t)=>e+Math.pow(Number(t)-a,2),0)/e.length).toFixed(4)},stanDevijacija=function(e=[]){return Math.sqrt(varijanca(e)).toFixed(4)},frekvencija=function(e=[]){let a=[...e].sort((e,a)=>e-a),t=a[0],n=0,r=[];const i=function(e,a){return[e,a]};return r=a.reduce((e,r,d)=>(r===t?(n++,d===a.length-1&&e.push(i(t,n))):(e.push(i(t,n)),n=1,t=r,d===a.length-1&&e.push(i(t,n))),e),[])},grupiranjeFrekvencija=function(e=[],a=1){let t=frekvencija(e);const n=t.length;let r=t[0][0],i=0,d=[];for(let e=0;e<n-1;e++)t[e][0]-r<a?(i+=t[e][1],e===n-2&&d.push(i)):(d.push(i),i=t[e][1],r=t[e][0],e===n-2&&(d.push(t[n-2][1]),d.push(t[n-1][1])));return d},dajNajmanje=function(e,a){let t=[];for(let n=0;n<a;n++)t.push(e[0]);return t},napraviObradu=function(e=[],a=e[0]){let t=e.slice(1,e.length);return{"aritmetičkaSredina":arimetickaSredina(e),medijan:medijan(e),raspon:[e[0],e[e.length-1]],odstupanjeOdSredine:prosAbOdstOdAritSred(e,this.arimetickaSredina),varijanca:varijanca(e,this.aritmetičkaSredina),standardnaDevijacija:stanDevijacija(e),najmanji:a,standarDevBezNajmanjeg:stanDevijacija(t)}},obradaPodataka=function(e=[]){let a=e.filter(e=>e.deep).sort((e,a)=>e.prosjek-a.prosjek),t=e.filter(e=>e.superf).sort((e,a)=>e.prosjek-a.prosjek),n=a.map(e=>e.prosjek),r=t.map(e=>e.prosjek);return{deep:a,superf:t,deepObrada:napraviObradu(n,a[0]),superfObrada:napraviObradu(r,t[0])}};let stanje=[],obrada=[];const kontejner=document.getElementById("kontejner"),kontejnerTablica=document.getElementById("kontejnertablica"),tablica=document.getElementById("tablica"),link=document.getElementById("link");link.download="tablica.txt",link.addEventListener("click",e=>{let a,t=Date.now(),n=prompt("Unesite ime datoteke","Datoteka");if(null==n||""==n)return;a=n+" "+t+" JSON.json",link.download=a;let r={};r=Object.assign({},obrada),console.log("ob0",r),console.log("obrada",obrada);let i=JSON.stringify(r);console.log("objson",i);let d=new Blob([i],{type:"text/plain"});link.href=URL.createObjectURL(d),URL.revokeObjectURL(link.herf)});const fileInput=document.getElementById("file");fileInput.style.display="none";const prikazDat=document.getElementById("prikazdat");fileInput.addEventListener("change",()=>{prikazDat.innerHTML="",prikazDat.innerHTML=fileInput.files[0].name,gumb()});const izaberi=document.getElementById("izaberi");function gumb(e){for(let e=0;e<fileInput.files.length;e++){let a=fileInput.files[e],t=a.name;const n=document.createElement("img"),r=document.createElement("div"),i=document.createElement("tr"),d=document.createElement("td"),o=document.createElement("td"),l=document.createElement("td"),c=new FileReader;c.readAsDataURL(a),c.onload=function(){n.src=c.result,n.onload=(()=>{kontejner.appendChild(n);let e=document.createElement("canvas"),a=document.createElement("canvas");const c=e.getContext("2d"),u=a.getContext("2d");e.width=n.width,e.height=n.height,a.width=n.width,a.height=n.height,c.drawImage(n,0,0);const p=c.getImageData(0,25,e.width,e.height-25,0,e.width,e.height-25),s=napraviRGB(p);let h=dajProsjekRgb(s);let j=rafiniraj(s,h).flat(),b=Uint8ClampedArray.from(j);const m=new ImageData(b,a.width,a.height-25);let f=100*(1-prosjekRafinirani(s));f=f.toFixed(2);let k=h;r.innerHTML=` RGB Prosjek ${k}  <br> \n    relativni postotak žila na ukupnoj na slici ${f} %`,d.innerText=t,l.textContent=f,o.textContent=k,i.appendChild(d),i.appendChild(l),tablica.append(i),u.putImageData(m,0,0);let g=document.createElement("h4");g.innerHTML=t,kontejner.appendChild(g),kontejner.appendChild(a),kontejner.appendChild(r),stanje.push(napraviObjekt(t,f,k)),obrada=Object.assign(obrada,obradaPodataka(stanje))})}}}izaberi.addEventListener("click",e=>{fileInput&&fileInput.click()},!1);
   </script>
