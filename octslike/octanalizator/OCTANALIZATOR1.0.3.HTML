<!DOCTYPE html><html lang="en"><head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta http-equiv="X-UA-Compatible" content="ie=edge"> <title>OCT ANGIO ANALIZATOR</title> <link rel="icon" href='data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD//gA7Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2NjIpLCBxdWFsaXR5ID0gNzUK/9sAQwADAgIDAgIDAwMDBAMDBAUIBQUEBAUKBwcGCAwKDAwLCgsLDQ4SEA0OEQ4LCxAWEBETFBUVFQwPFxgWFBgSFBUU/9sAQwEDBAQFBAUJBQUJFA0LDRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQU/8IAEQgADQAZAwERAAIRAQMRAf/EABcAAAMBAAAAAAAAAAAAAAAAAAYHCAT/xAAaAQEAAgMBAAAAAAAAAAAAAAAFAwYBAgQH/9oADAMBAAIQAxAAAAFA++Ea6ym7yNZfAyXg2akpHxzkKlqWqf/EABsQAAICAwEAAAAAAAAAAAAAAAMEBQYAAQIT/9oACAEBAAEFAn1SImY0uFCaq0FzVfXOJXpw4ILZMsFUEoln/8QAKhEAAQIEBAMJAAAAAAAAAAAAAQIDAAQFESExQWEGEPATFSJRUnGRsfH/2gAIAQMBAT8BZBcUW0jHLI9GE01+wJbV8GHZFxsBRSUx2e5ilMJ7/So4+Ii2mf37xMcQPonVoDYwuc1+ROit/wAh+vTFRbUw6kWx9eg3Xbq/L//EAC0RAAECAwQHCQAAAAAAAAAAAAIBEQADBAUhMUEGExVRYYGhEBQiU3GT0eHw/9oACAECAQE/Aa606cpcmofwOhPgnXPpFfpcaTpkilIGR2J357l4Y+kUulVUs3VVCoYcR5uyfmvjbJ+RK9sYn1p7N7uODfd26BsUTkazWLcKKzJm93SJdnBLUSEsUVcsn+Oz/8QAJhAAAQMCBQMFAAAAAAAAAAAAAQIDEQAEEhMhIkEFMZEQMjNh4f/aAAgBAQAGPwLLcjEDwatlt43LxSiXGyNgSO33Jp/qKCLW6QCcpLukgxEKk17U+KQw802tQcAS7EFKRO3TirVo3O1xeV8SeAn88V1S1zsYtLcvhRbEk6c9+fT/xAAgEAACAgEDBQAAAAAAAAAAAAABESExAEFRYRCBkdHh/9oACAEBAAE/IRnjHL5VhsJq8tt5FxEguBtOowD8s6Zs5oO28f58TmeWpYQMx4w+XJEiq2WJuB29miL7OBAezp0//9oADAMBAAIAAwAAABC4zjz/xAAeEQEBAAICAgMAAAAAAAAAAAABESExAEFR4RBhgf/aAAgBAwEBPxBTCdNi4JTb6vXnn5RPVwmpZkS4cCzPfeknZHseDfQ0lYrKO0YWqL3ENNESA2WxHYcA1QTjFnlaoq0ErxRjgUPj/8QAHREBAQEBAAMBAQEAAAAAAAAAAREhMQBBUXHB8P/aAAgBAgEBPxATs0AIHdjFDvUW8IdgXIAxKirB0ag0c3CsxklLIZOnT75/kP54RFNH3Wg4sfBj2Cqp8gqSCWp69pq8+o8vE9mMB389n75//8QAGhABAQEBAQEBAAAAAAAAAAAAAREhMQBBUf/aAAgBAQABPxA28kJck0gEhRx+AVfvXI4hy0GuTJ9HkG7ZQjkQQw9sN5lkwICI2jOe4TfHHKgFT9j6Wg+IK4pUKhG9XkAEnv/Z' type="image/gif" sizes="16x16"> <style>body{min-height: 100vh; padding: 20px; display: flex; flex-direction: column; justify-content: center; align-items: center; background: url('data:image/jpeg;base64,/9j/4AAQSkZJRgABAQEASABIAAD//gA7Q1JFQVRPUjogZ2QtanBlZyB2MS4wICh1c2luZyBJSkcgSlBFRyB2NjIpLCBxdWFsaXR5ID0gNzUK/9sAQwADAgIDAgIDAwMDBAMDBAUIBQUEBAUKBwcGCAwKDAwLCgsLDQ4SEA0OEQ4LCxAWEBETFBUVFQwPFxgWFBgSFBUU/9sAQwEDBAQFBAUJBQUJFA0LDRQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQU/8IAEQgADQAZAwERAAIRAQMRAf/EABcAAAMBAAAAAAAAAAAAAAAAAAYHCAT/xAAaAQEAAgMBAAAAAAAAAAAAAAAFAwYBAgQH/9oADAMBAAIQAxAAAAFA++Ea6ym7yNZfAyXg2akpHxzkKlqWqf/EABsQAAICAwEAAAAAAAAAAAAAAAMEBQYAAQIT/9oACAEBAAEFAn1SImY0uFCaq0FzVfXOJXpw4ILZMsFUEoln/8QAKhEAAQIEBAMJAAAAAAAAAAAAAQIDAAQFESExQWEGEPATFSJRUnGRsfH/2gAIAQMBAT8BZBcUW0jHLI9GE01+wJbV8GHZFxsBRSUx2e5ilMJ7/So4+Ii2mf37xMcQPonVoDYwuc1+ROit/wAh+vTFRbUw6kWx9eg3Xbq/L//EAC0RAAECAwQHCQAAAAAAAAAAAAIBEQADBAUhMUEGExVRYYGhEBQiU3GT0eHw/9oACAECAQE/Aa606cpcmofwOhPgnXPpFfpcaTpkilIGR2J357l4Y+kUulVUs3VVCoYcR5uyfmvjbJ+RK9sYn1p7N7uODfd26BsUTkazWLcKKzJm93SJdnBLUSEsUVcsn+Oz/8QAJhAAAQMCBQMFAAAAAAAAAAAAAQIDEQAEEhMhIkEFMZEQMjNh4f/aAAgBAQAGPwLLcjEDwatlt43LxSiXGyNgSO33Jp/qKCLW6QCcpLukgxEKk17U+KQw802tQcAS7EFKRO3TirVo3O1xeV8SeAn88V1S1zsYtLcvhRbEk6c9+fT/xAAgEAACAgEDBQAAAAAAAAAAAAABESExAEFRYRCBkdHh/9oACAEBAAE/IRnjHL5VhsJq8tt5FxEguBtOowD8s6Zs5oO28f58TmeWpYQMx4w+XJEiq2WJuB29miL7OBAezp0//9oADAMBAAIAAwAAABC4zjz/xAAeEQEBAAICAgMAAAAAAAAAAAABESExAEFR4RBhgf/aAAgBAwEBPxBTCdNi4JTb6vXnn5RPVwmpZkS4cCzPfeknZHseDfQ0lYrKO0YWqL3ENNESA2WxHYcA1QTjFnlaoq0ErxRjgUPj/8QAHREBAQEBAAMBAQEAAAAAAAAAAREhMQBBUXHB8P/aAAgBAgEBPxATs0AIHdjFDvUW8IdgXIAxKirB0ag0c3CsxklLIZOnT75/kP54RFNH3Wg4sfBj2Cqp8gqSCWp69pq8+o8vE9mMB389n75//8QAGhABAQEBAQEBAAAAAAAAAAAAAREhMQBBUf/aAAgBAQABPxA28kJck0gEhRx+AVfvXI4hy0GuTJ9HkG7ZQjkQQw9sN5lkwICI2jOe4TfHHKgFT9j6Wg+IK4pUKhG9XkAEnv/Z'); background-size: cover; background-repeat: no-repeat; background-position: center; background-color: rgb(255, 228, 196);}#tablica{margin-bottom: 30px; margin-top: 30px;}#file{margin: 20px;}canvas{margin: 10px;}img{margin: 10px;}nav{display: flex; top: 0; position: fixed; width: 100%; padding-right: 25px; padding-left: 10px; background-color: darkblue;}nav a{color: azure; text-decoration: none; text-align: center; padding: 14px 16px; transition: all 0.3s; font-weight: bolder; text-transform: uppercase;}nav a:hover{background-color: deepskyblue; color: whitesmoke;}h1{padding: 14px 16px; color: darkblue; font-weight: bolder; font-stretch: extra-expanded; font-size: 300%; text-align: center;}h4{text-transform: uppercase;}h2{text-transform: uppercase;}table{color: darkblue; padding: 10px 13px; width: 100%;}td, tr{text-align: center; padding: 14px 16px; font-weight: bolder; text-transform: uppercase;}.kontejner{background-color: rgba(245, 245, 245, 0.884); padding: 14px 20px; color: darkblue;}hr{padding: 10px;}#kontejnertablica{display: none;}#spiner{height: 100%; background-color: bisque; border-radius: 50%; color: darkblue; font-size: 20px; padding: 10px; margin-left: auto; cursor: default;}#klizac{color:darkblue; text-transform: uppercase;}h3{color:darkblue; text-transform: uppercase;}#slider::-webkit-slider-thumb{-webkit-appearance: none; height: 30px; width:30px; border-radius: 50%; background:darkblue; cursor: pointer;}#slider{-webkit-appearance: none; height: 30px; width:100%; border-radius:15px; background:#d3d3d3; outline: none; opacity: 0.7; transition:opacity .2s;}#slider:hover{opacity: 1;}</style></head><body> <nav> <a href="#" id='izaberi' class="gumb">Izaberi datoteku</a> <a href="#" id='obrada' class="gumb" >Prika≈æi obradu </a> <a href="#" id="link">Skini tablicu</a> <a href="#" id="spiner">üê¢</a> </nav> <div class="kontejner" id='kontejner'> <h1>OCT ANGIO ANALIZATOR ≈ΩBƒå</h1> <input type="file" name="datoteke" id="file" accept=".jpg, .jpeg, .png, .bmp" multiple> <h4 id="prikazdat"></h4> <br><table id="tablica" class="tablica"> <tr> <th>Slika naslov</th> <th>udio ≈æila i kapilara u %</th> </tr></table> </div><br><div class="kontejner" id="kontejnertablica"> </div><div class="klizac"> <h3>Raspon frekvencija u rasponu od</h3> <h3 id="brojac__slider">1</h3> <input type="range" name="korak" id="slider" min="1" max="10" step="1" value="1"></div></body>
<script>
    //***********************OBRADA ANGIO OCT  ≈ΩBƒå***************************************
    // VERZIJA 1.0.3.
    //AUTOR VLATKO VUƒåENIK 17.12.2019
    //******Funkcije html elementi
    const napraviTablicu=function(po=[],id){let tablica=document.createElement('table');tablica.setAttribute('class','tablica');let tr=document.createElement('tr');let th=document.createElement('th');let th1=document.createElement('th');th.textContent='Slika naslov';tr.appendChild(th);th1.textContent='udio ≈æila i kapilara u%';tr.appendChild(th1);tablica.appendChild(tr);po.forEach(x=>{let trp=document.createElement('tr');let td=document.createElement('td');let td1=document.createElement('td');td.innerText=x.naslov;trp.appendChild(td);td1.innerText=x.prosjek;trp.appendChild(td1);tablica.appendChild(trp)})
return tablica}
const napraviTablicuObrade=function(){kontejnerTablica.style.display='block';while(kontejnerTablica.firstChild){kontejnerTablica.removeChild(kontejnerTablica.firstChild)}
let odstupanjeOdSredineDeep=obrada.deepObrada.odstupanjeOdSredine;let aritmetiƒçkaSredinaDeep=obrada.deepObrada.aritmetiƒçkaSredina;let medijanDeep=obrada.deepObrada.medijan;let raspon1Deep=obrada.deepObrada.raspon[0];let raspon2Deep=obrada.deepObrada.raspon[1];let varijancaDeep=obrada.deepObrada.varijanca;let devijacijaDeep=obrada.deepObrada.standardnaDevijacija;let rsdDeep=obrada.deepObrada.rsd;let najmanjielemDeep=obrada.deepObrada.najmanji.naslov;if(najmanjielemDeep===undefined)najmanjielemDeep=" - ";let devijacijaBezNajmanjeg=obrada.deepObrada.najmanji.naslov;let standarDevBezNajmanjegD=obrada.deepObrada.standarDevBezNajmanjeg;let rsdDepB=((Number(standarDevBezNajmanjegD)/Number(aritmetiƒçkaSredinaDeep))*100).toFixed(2);if(isNaN(rsdDepB))rsdDepB=0;let aritmetiƒçkaSredinaF=obrada.superfObrada.aritmetiƒçkaSredina;let medinaF=obrada.superfObrada.medijan;let raspon1F=obrada.superfObrada.raspon[0];let raspon2F=obrada.superfObrada.raspon[1];let odstupanjeOdSredineF=obrada.superfObrada.odstupanjeOdSredine;let varijancaF=obrada.superfObrada.varijanca;let rsdF=obrada.superfObrada.rsd;let najmanjielemF=obrada.superfObrada.najmanji.naslov;if(najmanjielemF===undefined)najmanjielemF=" - ";let standarDevBezNajmanjegF=obrada.superfObrada.standarDevBezNajmanjeg;let rsdFB=((Number(standarDevBezNajmanjegF)/Number(aritmetiƒçkaSredinaF))*100).toFixed(2);if(isNaN(rsdFB))rsdFB=0;let devijacijaF=obrada.superfObrada.standardnaDevijacija?obrada.superfObrada.standardnaDevijacija:"";let obradaDeep=`<h4> Aritmetiƒçka sredina ${aritmetiƒçkaSredinaDeep} </h4>
<h4> Medijan ${medijanDeep} </h4>
<h4> Raspon ${raspon1Deep} - ${raspon2Deep} </h4>
<h4> Prosjeƒçno odstupanje od aritmetiƒçke sredine ${odstupanjeOdSredineDeep} </h4>
<h4> Varijanca ${varijancaDeep} </h4>
<h4> Standardna devijacija ${devijacijaDeep} </h4>
<h4> Relativna standardna devijacija ${rsdDeep} </h4>
<h4> Najmanja gustoƒáa ≈æila ${najmanjielemDeep} </h4>
<h4> Standardna devijacija bez najmanjeg elementa ${standarDevBezNajmanjegD}  RSD ${rsdDepB} </h4>
`
let obradaSuper=`<h4> Aritmetiƒçka sredina ${aritmetiƒçkaSredinaF} </h4>
<h4> Medijan ${medinaF} </h4>
<h4> Raspon ${raspon1F} - ${obrada.superfObrada.raspon[1]} </h4>
<h4> Prosjeƒçno odstupanje od aritmetiƒçke sredine ${odstupanjeOdSredineF} </h4>
<h4> Varijanca ${varijancaF} </h4>
<h4> Standardna devijacija ${devijacijaF} </h4>
<h4> Relativna standardna devijacija ${rsdF} </h4>
<h4> Najmanja gustoƒáa ≈æila ${najmanjielemF} </h4>
<h4> Standardna devijacija bez najmanjeg elementa ${standarDevBezNajmanjegF}  RSD ${rsdFB} </h4>
`
kontejnerTablica.insertAdjacentHTML('afterBegin',' <h2>Obrada DEEP</h2>');kontejnerTablica.appendChild(napraviTablicu(obrada.deep,'pr'));kontejnerTablica.insertAdjacentHTML('beforeEnd',obradaDeep);kontejnerTablica.insertAdjacentHTML('beforeEnd',' <h2>Obrada superficijal</h2>');kontejnerTablica.appendChild(napraviTablicu(obrada.superf,'pr'));kontejnerTablica.insertAdjacentHTML('beforeEnd',obradaSuper)}
const napraviTablicuObrade2=function(obrada={}){kontejnerTablica.style.display='block';while(kontejnerTablica.firstChild){kontejnerTablica.removeChild(kontejnerTablica.firstChild)}
let odstupanjeOdSredineDeep=obrada.deepObrada.odstupanjeOdSredine;let aritmetiƒçkaSredinaDeep=obrada.deepObrada.aritmetiƒçkaSredina;let medijanDeep=obrada.deepObrada.medijan;let raspon1Deep=obrada.deepObrada.raspon[0];let raspon2Deep=obrada.deepObrada.raspon[1];let varijancaDeep=obrada.deepObrada.varijanca;let devijacijaDeep=obrada.deepObrada.standardnaDevijacija;let rsdDeep=obrada.deepObrada.rsd;let aritmetiƒçkaSredinaF=obrada.superfObrada.aritmetiƒçkaSredina;let medinaF=obrada.superfObrada.medijan;let raspon1F=obrada.superfObrada.raspon[0];let raspon2F=obrada.superfObrada.raspon[1];let odstupanjeOdSredineF=obrada.superfObrada.odstupanjeOdSredine;let varijancaF=obrada.superfObrada.varijanca;let rsdF=obrada.superfObrada.rsd;let devijacijaF=obrada.superfObrada.standardnaDevijacija?obrada.superfObrada.standardnaDevijacija:"";let obradaDeep=`<h4> Aritmetiƒçka sredina ${aritmetiƒçkaSredinaDeep} </h4>
<h4> Medijan ${medijanDeep} </h4>
<h4> Raspon ${raspon1Deep} - ${raspon2Deep} </h4>
<h4> Prosjeƒçno odstupanje od aritmetiƒçke sredine ${odstupanjeOdSredineDeep} </h4>
<h4> Varijanca ${varijancaDeep} </h4>
<h4> Standardna devijacija ${devijacijaDeep} </h4>
<h4> Relativna standardna devijacija ${rsdDeep} </h4>
`
let obradaSuper=`<h4> Aritmetiƒçka sredina ${aritmetiƒçkaSredinaF} </h4>
<h4> Medijan ${medinaF} </h4>
<h4> Raspon ${raspon1F} - ${obrada.superfObrada.raspon[1]} </h4>
<h4> Prosjeƒçno odstupanje od aritmetiƒçke sredine ${odstupanjeOdSredineF} </h4>
<h4> Varijanca ${varijancaF } </h4>
<h4> Standardna devijacija ${devijacijaF} </h4>
<h4> Relativna standardna devijacija ${rsdF} </h4>
`
kontejnerTablica.insertAdjacentHTML('afterBegin',' <h2>Obrada DEEP</h2>');kontejnerTablica.appendChild(napraviTablicu(obrada.deep,'pr'));kontejnerTablica.insertAdjacentHTML('beforeEnd',obradaDeep);kontejnerTablica.insertAdjacentHTML('beforeEnd',' <h2>Obrada superficijal</h2>');kontejnerTablica.appendChild(napraviTablicu(obrada.superf,'pr'));kontejnerTablica.insertAdjacentHTML('beforeEnd',obradaSuper)}
const napraviRGB=(x=[])=>{let polje=[];let duzina=x.data.length;for(let i=0;i<x.data.length;i=i+4){let rgb=[];rgb.push(x.data[i]);rgb.push(x.data[i+1]);rgb.push(x.data[i+2]);rgb.push(x.data[i+3]);polje.push(rgb)}
return polje};const raspodjela=function(x=[]){let racuna=x.reduce((ak,val)=>{if(val[0]<51||val[1]<51||val[2]<51){ak[0]=ak[0]+1};if((val[0]<102&&val[0]>51)||(val[1]<102&&val[1]>51)||(val[2]<102&&val[2]>51)){ak[1]=ak[1]+1}
if((val[0]<153&&val[0]>102)||(val[1]<153&&val[1]>102)||(val[2]<153&&val[2]>102)){ak[2]=ak[2]+1};if((val[0]<204&&val[0]>153)||(val[1]<204&&val[1]>153)||(val[2]<204&&val[2]>153)){ak[3]=ak[3]+1};if((val[0]>204)||(val[1]>204)||(val[2]>204)){ak[4]=ak[4]+1};return ak},[0,0,0,0,0])
racuna=racuna.map(y=>{return((y/x.length)*100).toFixed(1)});return racuna}
const obrniRGB=(x=[])=>{let polje=[];let duzina=x.data.length;for(let i=0;i<x.data.length;i=i+4){let rgb=[];polje.push(255-x.data[i]);polje.push(255-x.data[i+1]);polje.push(255-x.data[i+2]);polje.push(x.data[i+3])}
return polje}
const dajProsjekRgb=function(x=[]){let uk=x.reduce((ak,val)=>{ak[0]=ak[0]+val[0];ak[1]=ak[1]+val[1];ak[2]=ak[2]+val[2];ak[3]=ak[3]+val[3];return ak},[0,0,0,0])
uk=uk.map(y=>y/x.length);uk=Math.ceil(uk[0]);return uk};const rafiniraj=function(po=[],pro=110){let rez=po.reduce((ak,val)=>{if(val[0]<pro||val[1]<pro||val[2]<pro){ak.push([255,255,255,255])}else if(val[0]>153||val[1]>153||val[2]>153){ak.push([255,0,0,255])}else if((val[0]<153&&val[0]>pro)||(val[1]<153&&val[1]>pro)||(val[2]<153&&val[2]>pro)){ak.push([0,255,0,255])}
else{ak.push([255,255,255,255])}
return ak},[])
return rez}
const prosjekRafinirani=function(po=[],pro=110){let poRaf=po.filter(val=>(val[0]<pro||val[1]<pro||val[2]<pro));return poRaf.length/po.length};const napraviObjekt=function(x='',y=0,z=0){let naslov=x;let deep=/deep/ig.test(naslov);let superf=/superficial/ig.test(naslov);return{naslov:x,prosjek:y,rgbprosjek:z,deep:deep,superf:superf}}
const arimetickaSredina=function(po=[]){let zbroj=po.reduce((ak,val)=>{return ak+Number(val)},0)
let N=po.length||1;return(zbroj/N).toFixed(2)}
const medijan=function(po=[]){let po1=[...po];po1.sort((a,b)=>a-b);if(po1.length){let N=po1.length;let sredina=Math.floor(N/2);if(N%2===0){let a=Number(po1[(sredina-1)]);let b=Number(po1[sredina]);let r=(a+b)/2;return r.toFixed(2)}else{return Number(po1[sredina]).toFixed(2)}}}
const raspon=function(po=[]){let sortirano=[...po];sortirano.sort((a,b)=>a-b);return(Number(sortirano[(sortirano.length-1)])-Number(sortirano[0])).toFixed(2)}
const prosAbOdstOdAritSred=function(po=[],aritSredina=arimetickaSredina(po)){let odstupanje=po.reduce((ak,val)=>{return ak+Math.abs(Number(val)-aritSredina)},0)
return(odstupanje/po.length).toFixed(2)}
const varijanca=function(po=[],aritSredina=arimetickaSredina(po)){let odstupanjeKvadratno=po.reduce((ak,val)=>{return ak+Math.pow((Number(val)-aritSredina),2)},0)
return(odstupanjeKvadratno/po.length).toFixed(4)}
const stanDevijacija=function(po=[]){return(Math.sqrt(varijanca(po))).toFixed(4)}
const frekvencija=function(po=[]){let poSort=[...po].sort((a,b)=>a-b);let prvi=poSort[0];let brojac=0;let poljeFrek=[];const fukObj=function(ime,broj){return{ime,broj}};const fukPolje=function(ime,broj){return[ime,broj]};poljeFrek=poSort.reduce((ak,val,i)=>{if(val===prvi){brojac++;if(i===(poSort.length-1)){ak.push(fukPolje(prvi,brojac))}}else{ak.push(fukPolje(prvi,brojac));brojac=1;prvi=val;if(i===(poSort.length-1)){ak.push(fukPolje(prvi,brojac))}}
return ak},[]);return poljeFrek}
const grupiranjeFrekvencija=function(po=[],raspon=1){let fren=frekvencija(po);const duzina=fren.length;let prvi=fren[0][0];let brojac=0;let grupa=[];for(let i=0;i<duzina-1;i++){if((fren[i][0]-prvi)<raspon){brojac=brojac+fren[i][1];if(i===duzina-2){grupa.push(brojac)}}else{grupa.push(brojac);brojac=fren[i][1];prvi=fren[i][0];if(i===duzina-2){grupa.push(fren[duzina-2][1]);grupa.push(fren[duzina-1][1])}}}
return grupa}
const dajNajmanje=function(po,x){let rez=[];for(let i=0;i<x;i++){rez.push(po[0])}
return rez}
const relativnoStandardnoOdstupanje=function(po=[]){let x=arimetickaSredina(po);let s=stanDevijacija(po);let rsd=(s/x)*100;if(isNaN(rsd))rsd=0;return rsd.toFixed(2)}
const frekvencijePromise=function(polje=[],korak=1){return new Promise((res,odb)=>{let po=[...polje];po.sort((a,b)=>a-b)
let frekPolje=[];let nutarnjePolje=[];let prvi=Number(po[0]);for(let i=0;i<po.length;i++){if((Number(po[i])-prvi)<korak){nutarnjePolje.push(po[i]);if(i===(po.length-1)){frekPolje.push(nutarnjePolje)}}else{frekPolje.push(nutarnjePolje);nutarnjePolje=[];prvi=Number(po[i]);nutarnjePolje.push(po[i]);if(i===(po.length-1)){frekPolje.push(nutarnjePolje)}}}
res(frekPolje);odb('Gre≈°ka u obradi frekvencija')})}
const napraviObradu=function(deepPolje=[],x=deepPolje[0]){let deepBezPrvog=deepPolje.slice(1,deepPolje.length);if(deepPolje.length<=1){deepBezPrvog=[0]};return{aritmetiƒçkaSredina:arimetickaSredina(deepPolje),medijan:medijan(deepPolje),raspon:[deepPolje[0],deepPolje[deepPolje.length-1]],odstupanjeOdSredine:prosAbOdstOdAritSred(deepPolje,this.arimetickaSredina),varijanca:varijanca(deepPolje,this.aritmetiƒçkaSredina),standardnaDevijacija:stanDevijacija(deepPolje),najmanji:x,rsd:relativnoStandardnoOdstupanje(deepPolje),standarDevBezNajmanjeg:stanDevijacija(deepBezPrvog)}}
const obradaPodataka=function(sta=[]){let deep=sta.filter(x=>x.deep).sort((a,b)=>a.prosjek-b.prosjek);let superf=sta.filter((x=>x.superf)).sort((a,b)=>a.prosjek-b.prosjek);let deepPolje=deep.length>0?deep.map(x=>x.prosjek):[0];let superPolje=superf.length>0?superf.map(x=>x.prosjek):[0];let deepObrada=napraviObradu(deepPolje,deep[0]);let superfObrada=napraviObradu(superPolje,superf[0]);return{deep,superf,deepObrada,superfObrada}}
const nacrtajGrafCanvas=function(polje=[]){if(polje.length>0){let zadnji=polje[polje.length-1];let z;if(zadnji===undefined){z=0}else{z=zadnji[zadnji.length-1]}
let raspon=[polje[0][0],z];const razmak=5;let frek=Number(raspon[0]);const boje=["lightblue","lightgreen","pink","silver","lightblue","lightgreen","pink","silver","lightblue","lightgreen","pink","silver"]
let razlika=Number(raspon[1])-Number(raspon[0]);let sirina=Math.ceil(razlika/razmak);if(sirina===0)sirina=1;let faktor=Math.ceil(240/razlika);let brojStpoaca=polje.length;let korak=Math.ceil(razlika/brojStpoaca)*faktor;let can2=document.createElement('canvas');can2.setAttribute('width','300px');can2.setAttribute('height','300px');let graf=can2.getContext("2d");graf.strokeRect(0,0,300,300)
let xGraf=10;let yGraf=0;let najveciStupac=polje.reduce((rez,val)=>{return rez<val.length?val.length:rez},-Infinity)
let brojac=0
const crtajGraf=function(x){let visina=(x.length/najveciStupac)*300*0.8;yGraf=299-visina;graf.fillStyle=boje[brojac]||"blue";graf.fillRect(xGraf,yGraf,30,visina);graf.save();graf.font="20px Times";graf.fillStyle='red';graf.translate(xGraf+10,80)
graf.fillText(x.length,0,0)
graf.restore();graf.save();graf.font="10px Times";graf.fillStyle='red';graf.translate(xGraf+5,290)
graf.fillText(x[0],0,0)
graf.restore();xGraf=xGraf+korak;brojac++
frek=frek+Number(sirina)}
polje.forEach(crtajGraf)
return can2}
else{return document.createElement('div')}}
const dajDep=function(x=[],y=1){let mapx=x.deep.map((x)=>x.prosjek);frekvencijePromise(mapx,y).then(x=>{let graf=nacrtajGrafCanvas(x);kontejnerTablica.insertAdjacentHTML("beforeEnd","<h3>deep</h3>")
kontejnerTablica.insertAdjacentElement('beforeEnd',graf)})}
const dajSuperf=function(x=[],y=1){let mapx=x.superf.map((x)=>x.prosjek);frekvencijePromise(mapx,y).then(x=>{let graf=nacrtajGrafCanvas(x);kontejnerTablica.insertAdjacentHTML("beforeEnd","<h3>superficijal</h3>")
kontejnerTablica.insertAdjacentElement('beforeEnd',graf)})}
const updateStanje=function(y=1){napraviTablicuObrade2(obrada);dajDep(obrada,y);dajSuperf(obrada,y);klasaKlizaci.style.display="block"}
let stanje=[];let obrada=[];const kontejner=document.getElementById('kontejner');const kontejnerTablica=document.getElementById('kontejnertablica')
const spiner=document.getElementById('spiner');const linkObrada=document.getElementById('obrada');linkObrada.addEventListener('click',function(){if(obrada.deep||obrada.superf){updateStanje();klasaKlizaci.style.display="block"}})
const slider=document.getElementById('slider');const klasaKlizaci=document.querySelector(".klizac");klasaKlizaci.style.display="none";const brojacSlider=document.getElementById("brojac__slider")
slider.addEventListener("change",function(){brojacSlider.innerHTML=this.value;updateStanje(this.value)})
const tablica=document.getElementById('tablica');const link=document.getElementById('link');link.download='tablica.txt';link.addEventListener('click',e=>{let txt;let datum=Date.now();let ime=prompt("Unesite ime datoteke","Datoteka");if(ime==null||ime==""){return}else{txt=ime+" "+datum+" JSON.json";link.download=txt}
let ob={};ob=Object.assign({},obrada);let obJson=JSON.stringify(ob);let blob1=new Blob([obJson],{type:'text/plain'});link.href=URL.createObjectURL(blob1);URL.revokeObjectURL(link.herf)})
const fileInput=document.getElementById('file');fileInput.style.display="none";const prikazDat=document.getElementById('prikazdat');fileInput.addEventListener('change',()=>{prikazDat.innerHTML="";prikazDat.innerHTML=fileInput.files[0].name;gumb()})
const izaberi=document.getElementById('izaberi');izaberi.addEventListener('click',e=>{if(fileInput){fileInput.click()}},!1)
function gumb(ev){let brojFajlova=fileInput.files.length-1;setTimeout(window.requestAnimationFrame(()=>spiner.innerHTML=`${brojFajlova} üêá`),200);let borojFile=fileInput.files.length-1;const napraviFunkciju=function(){if(brojFajlova===-1)return;let fileName=fileInput.files[brojFajlova].name;new Promise((res,odb)=>{res(fileInput.files[brojFajlova])}).then(file=>{let reader=new FileReader();reader.readAsDataURL(file);return reader}).then(reader=>{reader.onload=function(){const img=document.createElement("img");const podaci=document.createElement("div");const redak=document.createElement('tr');const poljeN=document.createElement('td');const poljeR=document.createElement('td');const poljeP=document.createElement('td');img.src=reader.result;img.onload=()=>{spiner.innerHTML=`${brojFajlova} üêá`;if(Number(brojFajlova)===0||(Number(brojFajlova))===1){setTimeout(()=>spiner.innerHTML=`üêú `,5000)}
borojFile--;kontejner.appendChild(img);let can=document.createElement('canvas');let can1=document.createElement('canvas');const ctx=can.getContext('2d');const ctx1=can1.getContext('2d');can.width=img.width;can.height=img.height;can1.width=img.width;can1.height=img.height;ctx.drawImage(img,0,0);const imgData=ctx.getImageData(0,25,can.width,can.height-25,0,can.width,can.height-25);const indexPolje=napraviRGB(imgData);let RGBprosjek=dajProsjekRgb(indexPolje);const crvenData=rafiniraj(indexPolje,RGBprosjek);let crvenDataF=crvenData.flat();let crvenDataF8=Uint8ClampedArray.from(crvenDataF);const obData1=new ImageData(crvenDataF8,can1.width,can1.height-25);let prosjek=(1-prosjekRafinirani(indexPolje))*100;prosjek=prosjek.toFixed(2);let rGb=RGBprosjek;podaci.innerHTML=` RGB Prosjek ${rGb}  <br> 
    relativni postotak ≈æila na ukupnoj na slici ${ prosjek} %`;poljeN.innerText=fileName;poljeP.textContent=prosjek;poljeR.textContent=rGb;redak.appendChild(poljeN);redak.appendChild(poljeP);tablica.append(redak);ctx1.putImageData(obData1,0,0);let naslov=document.createElement('h4');naslov.innerHTML=fileName;kontejner.appendChild(naslov);kontejner.appendChild(can1);kontejner.appendChild(podaci);stanje.push(napraviObjekt(fileName,prosjek,rGb))
obrada=Object.assign(obrada,obradaPodataka(stanje));if(img.complete){if(brojFajlova>-1){brojFajlova--;napraviFunkciju()}}}}})}
napraviFunkciju()}

</script>

</html>